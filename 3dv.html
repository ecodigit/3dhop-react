<!DOCTYPE>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<meta content="charset=UTF-8"/>
<title>3DHOP - 3D Heritage Online Presenter</title>
<!--STYLESHEET-->
<link type="text/css" rel="stylesheet" href="stylesheet/3dhop.css"/>  
<!--SPIDERGL-->
<script type="text/javascript" src="js/spidergl.js"></script>
<!--JQUERY-->
<script type="text/javascript" src="js/jquery.js"></script>
<!--PRESENTER-->
<script type="text/javascript" src="js/presenter.js"></script>
<!--3D MODELS LOADING AND RENDERING-->
<script type="text/javascript" src="js/nexus.js"></script>
<script type="text/javascript" src="js/ply.js"></script>
<!--TRACKBALLS-->
<script type="text/javascript" src="js/trackball_sphere.js"></script>
<script type="text/javascript" src="js/trackball_turntable.js"></script>
<script type="text/javascript" src="js/trackball_turntable_pan.js"></script>
<script type="text/javascript" src="js/trackball_pantilt.js"></script>
<!--UTILITY-->
<script type="text/javascript" src="js/init.js"></script>
</head>
<body>
<div id="3dhop" class="tdhop" onmousedown="if (event.preventDefault) event.preventDefault()"><div id="tdhlg"></div>
 <div id="toolbar">
  <img id="home"       title="Home"                  src="skins/light/home.png"            /><br/>
  <img id="zoomin"     title="Zoom In"               src="skins/light/zoomin.png"          /><br/>
  <img id="zoomout"    title="Zoom Out"              src="skins/light/zoomout.png"         /><br/>
  <img id="light_on"   title="Disable Light Control" src="skins/light/lightcontrol_on.png" style="position:absolute; visibility:hidden;"/>
  <img id="light"      title="Enable Light Control"  src="skins/light/lightcontrol.png"    /><br/>
  <img id="sections_on" title="Disable Plane Sections" src="skins/dark/sections_on.png" 
                                                          style="position:absolute; visibility:hidden;"/>
  <img id="sections"    title="Enable Plane Sections"  src="skins/dark/sections.png"     /><br/>
  <img id="measure_on" title="Disable Measure Tool"  src="skins/light/measure_on.png"      style="position:absolute; visibility:hidden;"/>
  <img id="measure"    title="Enable Measure Tool"   src="skins/light/measure.png"         /><br/>
  <img id="full_on"    title="Exit Full Screen"      src="skins/light/full_on.png"         style="position:absolute; visibility:hidden;"/>
  <img id="full"       title="Full Screen"           src="skins/light/full.png"            />
 </div>
 <div id="sections-box" class="output-box">
  <table class="output-table" onmousedown="event.stopPropagation()">
   <tr><td>Plane</td><td>Position</td><td>Flip</td></tr>
   <tr><td><hr/></td><td><hr/></td><td><hr/></td></tr>
   <tr>
    <td><img   id="xplane_on"    title="…" src="skins/icons/sectionX_on.png" onclick="sectionxSwitch()" 
                                        style="position:absolute; visibility:hidden; border:1px inset;"/>
        <img   id="xplane"       title="…" src="skins/icons/sectionX.png"    onclick="sectionxSwitch()"/><br/></td>
    <td><input id="xplaneSlider" class="output-input"  type="range"    title="…"/></td> 
    <td><input id="xplaneFlip"   class="output-input"  type="checkbox" title="…"/></td>
   </tr>
   <tr>
    <td><img   id="yplane_on"    title="…" src="skins/icons/sectionY_on.png" onclick="sectionySwitch()" 
                                        style="position:absolute; visibility:hidden; border:1px inset;"/>
        <img   id="yplane"       title="…" src="skins/icons/sectionY.png"    onclick="sectionySwitch()"/><br/></td>
    <td><input id="yplaneSlider" class="output-input"  type="range"    title="…"/></td> 
    <td><input id="yplaneFlip"   class="output-input"  type="checkbox" title="…"/></td>
   </tr>
   <tr>
    <td><img   id="zplane_on"    title="…" src="skins/icons/sectionZ_on.png" onclick="sectionzSwitch()" 
                                        style="position:absolute; visibility:hidden; border:1px inset;"/>
        <img   id="zplane"       title="…" src="skins/icons/sectionZ.png"    onclick="sectionzSwitch()"/><br/></td>
    <td><input id="zplaneSlider" class="output-input"  type="range"    title="…"/></td> 
    <td><input id="zplaneFlip"   class="output-input"  type="checkbox" title="…"/></td>
   </tr>
  </table>
  <table class="output-table" onmousedown="event.stopPropagation()" style="text-align:right;">
   <tr>
    <td>Show planes<input id="showPlane" class="output-input" type="checkbox" title="…"/></td>
    <td>Show edges<input id="showBorder" class="output-input" type="checkbox" title="…"/></td>
   </tr>
  </table>
 </div>
 <canvas id="draw-canvas" style="background-image: url(skins/backgrounds/light.jpg)"/>
</div>
 <div id="measure-box" class="output-box">Measured length<hr/><span id="measure-output" class="output-text" onmousedown="event.stopPropagation()">0.0</span></div>
<!-- <canvas id="draw-canvas" style="background-image: url(skins/backgrounds/dark.jpg)"/> -->
</div>
</body>

<script type="text/javascript">
var presenter = null;

function getUrlVars() {
	var vars = {};
	var parts = window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi, function(m,key,value) {
	vars[key] = value;
});
return vars;
}

function setup3dhop() { 
        var phi = getUrlVars()["phi"];
        var theta = getUrlVars()["theta"];
	var model = getUrlVars()["mod"];
	presenter = new Presenter("draw-canvas");

	presenter.setScene({
		meshes: {
			"PV_Multi"  : { url: model    }
		},
		modelInstances : {
			"Model1" : { mesh : "PV_Multi" }
		},
		trackball: {
			type : TurnTableTrackball,
			trackOptions : {
                                startPhi: phi,
                                startTheta: theta,
				startDistance: 2.5,
                                minMaxPhi: [-360,360],
                                minMaxTheta: [-360.0,360.0],
				minMaxDist: [0.0, 3.0]
			}
		},
		space: {
			centerMode: "scene",
			radiusMode: "scene"
		}
	});
	presenter._onEndMeasurement = onEndMeasure;
}


function actionsToolbar(action) {
	if(action=='home') presenter.resetTrackball(); 
	else if(action=='zoomin') presenter.zoomIn();
	else if(action=='zoomout') presenter.zoomOut(); 
	else if(action=='light' || action=='light_on') { presenter.enableLightTrackball(!presenter.isLightTrackballEnabled()); lightSwitch(); } 
  	else if(action=='sections' || action=='sections_on') { 
    		sectiontoolReset(); sectiontoolSwitch(); } 
	else if(action=='measure' || action=='measure_on') { presenter.enableMeasurementTool(!presenter.isMeasurementToolEnabled()); measureSwitch(); } 
	else if(action=='full' || action=='full_on') fullscreenSwitch(); 
}

function onEndMeasure(measure) {
	// measure.toFixed(2) sets the number of decimals when displaying the measure
	// depending on the model measure units, use "mm","m","km" or whatever you have
	$('#measure-output').html(measure.toFixed(2) + " cm");
}

$(document).ready(function(){
	init3dhop();
	setup3dhop();

	sectiontoolInit();
});
</script>
</html>
